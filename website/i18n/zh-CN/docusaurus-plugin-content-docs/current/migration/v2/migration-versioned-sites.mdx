---
slug: /migration/v2/versioned-sites
---

# 版本化站点

首先请阅读 https://docusaurus.io/blog/2018/09/11/Towards-Docusaurus-2#versioning 了解 v1 方法中的问题。

:::note

版本化的文档通常应由[迁移 CLI](./migration-automated.mdx) 正确迁移。

:::

## 迁移您的 `versioned_docs` front matter {#migrate-your-versioned_docs-front-matter}

与 v1 不同，每个版本化文档的 Markdown 头部不再通过使用 `version-${version}-${original_id}` 作为实际 ID 字段的值来更改。请参阅以下场景以获得更好的解释。

例如，如果您有一个 `docs/hello.md`。

```md
---
id: hello
title: Hello, World !
---

Hi, Endilie here :)
```

当您发布一个新版本 1.0.0 时，在 Docusaurus v1 中，`website/versioned_docs/version-1.0.0/hello.md` 如下所示：

```md
---
id: version-1.0.0-hello
title: Hello, World !
original_id: hello
---

Hi, Endilie here :)
```

相比之下，Docusaurus 2 的 `website/versioned_docs/version-1.0.0/hello.md` 如下所示（与原始文件完全相同）：

```md
---
id: hello
title: Hello, World !
---

Hi, Endilie here :)
```

由于我们采用快照方式，并允许人们在版本内轻松移动（和编辑）文档，`id` front matter 不再被更改，并将保持不变。在内部，它被设置为 `version-${version}/${id}`。

基本上，每个 versioned_docs 文件中必要的更改如下：

```diff {2-3,5}
---
- id: version-1.0.0-hello
+ id: hello
title: Hello, World !
- original_id: hello
---
Hi, Endilie here :)
```

## 迁移您的 `versioned_sidebars` {#migrate-your-versioned_sidebars}

- 将 `versioned_docs` ID 引用为 `version-${version}/${id}` (v2) 而不是 `version-${version}-${original_id}` (v1)。

因为在 v1 中，很有可能有人创建了一个 front matter ID 为 `"version-${version}-${id}"` 的新文件，这可能与 `versioned_docs` ID 冲突。

例如，Docusaurus 1 无法区分 `docs/xxx.md`

```md
---
id: version-1.0.0-hello
---

另一个内容
```

与 `website/versioned_docs/version-1.0.0/hello.md`

```md
---
id: version-1.0.0-hello
title: Hello, World !
original_id: hello
---

Hi, Endilie here :)
```

由于我们在 v1 和 v2 中不允许在 front matter 中使用 `/`，冲突发生的可能性较小。

所以 v1 用户需要迁移他们的 versioned_sidebars 文件。

示例 `versioned_sidebars/version-1.0.0-sidebars.json`：

```diff {2-3,5-6,9-10}  title="versioned_sidebars/version-1.0.0-sidebars.json"
{
+ "version-1.0.0/docs": {
- "version-1.0.0-docs": {
    "Test": [
+    "version-1.0.0/foo/bar",
-    "version-1.0.0-foo/bar",
    ],
    "Guides": [
+    "version-1.0.0/hello",
-    "version-1.0.0-hello"
    ]
  }
}
```

## 填充您的 `versioned_sidebars` 和 `versioned_docs` {#populate-your-versioned_sidebars-and-versioned_docs}

在 v2 中，我们对文档版本控制使用快照方法。**每个版本化的文档不依赖于其他版本**。`foo.md` 可能存在于 `version-1.0.0` 中，但在 `version-1.2.0` 中不存在。这在以前的版本中是不可能的，因为 Docusaurus v1 的回退功能（https://v1.docusaurus.io/docs/en/versioning#fallback-functionality）。

例如，如果您的 `versions.json` 在 v1 中如下所示：

```json title="versions.json"
["1.1.0", "1.0.0"]
```

Docusaurus v1 **仅当文档内容不同时**才创建版本化的文档。如果从 v1.0.0 到 v1.1.0 唯一更改的文档是 `hello.md`，您的文档结构可能如下所示：

```bash
website
├── versioned_docs
│   ├── version-1.1.0
│   │   └── hello.md
│   └── version-1.0.0
│       ├── foo
│       │   └── bar.md
│       └── hello.md
├── versioned_sidebars
│   └── version-1.0.0-sidebars.json
```

在 v2 中，您必须填充缺失的 `versioned_docs` 和 `versioned_sidebars`（也要有正确的 front matter 和 ID 引用）。

```bash {3-5,12}
website
├── versioned_docs
│   ├── version-1.1.0
│   │   ├── foo
│   │   │   └── bar.md
│   │   └── hello.md
│   └── version-1.0.0
│       ├── foo
│       │   └── bar.md
│       └── hello.md
├── versioned_sidebars
│   ├── version-1.1.0-sidebars.json
│   └── version-1.0.0-sidebars.json
```

## 在 MDX 中将样式属性转换为样式对象 {#convert-style-attributes-to-style-objects-in-mdx}

Docusaurus 2 对文档文件使用 JSX。如果您的 Docusaurus 1 文档中有任何样式属性，请将它们转换为样式对象，如下所示：

```diff
---
id: demo
title: Demo
---

## Section

hello world

- <pre style="background: black">zzz</pre>
+ <pre style={{background: 'black'}}>zzz</pre>
```
