---
keywords:
  - algolia
  - search
---

# 搜索

您可以使用以下几个选项为您的网站添加搜索功能：

- 🥇 [Algolia DocSearch](#using-algolia-docsearch) (**官方**)
- 👥 [Typesense DocSearch](#using-typesense-docsearch)
- 👥 [本地搜索](#using-local-search)
- 👥 [您自己的 `SearchBar` 组件](#using-your-own-search)

:::info

🥇 Docusaurus 为 [Algolia DocSearch](#using-algolia-docsearch) 提供**一流的支持**。

👥 其他选项由**社区维护**：请向其各自的仓库报告错误。

:::

## 🥇 使用 Algolia DocSearch {#using-algolia-docsearch}

Docusaurus 对 [Algolia DocSearch](https://docsearch.algolia.com) 提供**官方支持**。

该服务对任何开发者文档或技术博客都是**免费**的：只需确保阅读[清单](https://docsearch.algolia.com/docs/who-can-apply/)并[申请 DocSearch 项目](https://docsearch.algolia.com/apply)。

DocSearch 每周会抓取您的网站一次（计划可从 Web 界面配置），并将所有内容聚合到一个 Algolia 索引中。然后，这些内容会通过 Algolia API 直接从您的前端查询。

如果您的网站[不符合](https://docsearch.algolia.com/docs/who-can-apply)免费托管版 DocSearch 的条件，或者您的网站位于防火墙之后且不公开，那么您可以[自行运行](https://docsearch.algolia.com/docs/run-your-own/) DocSearch crawler。

:::note

默认情况下，Docusaurus preset 会生成一个 Algolia crawler 可以使用的 [sitemap.xml](https://docusaurus.io/sitemap.xml)。

:::

:::info 来自旧版 docsearch？

您可以在[我们的博文](/blog/2021/11/21/algolia-docsearch-migration)或 [DocSearch 迁移文档](https://docsearch.algolia.com/docs/migrating-from-legacy)中阅读更多关于从旧版 DocSearch 基础设施迁移的信息。

:::

### 索引配置 {#algolia-index-configuration}

在您的申请获得批准并部署后，您将收到一封电子邮件，其中包含将 DocSearch 添加到您项目中的所有详细信息。您可以通过[Web 界面](https://crawler.algolia.com/)编辑和管理您的抓取任务。索引在部署后立即可用，因此通常不需要手动配置。

:::danger 使用推荐的 crawler 配置

强烈建议使用我们官方的 [**Docusaurus v3 crawler 配置**](https://docsearch.algolia.com/docs/templates/#docusaurus-v3-template)。如果您选择不同的 crawler 配置，我们无法提供支持。

:::

:::warning 更新 crawler 配置时

crawler 配置包含一个 `initialIndexSettings`，它仅在您的 Algolia 索引尚不存在时用于初始化。

如果您更新了 `initialIndexSettings` crawler 设置，虽然可以通过界面手动更新索引，但 [Algolia 团队建议删除您的索引然后重新开始一次抓取](https://github.com/facebook/docusaurus/issues/9200#issuecomment-1667338492)以使用新设置完全重新初始化它。

:::

### 连接 Algolia {#connecting-algolia}

Docusaurus 自带的 `@docusaurus/preset-classic` 支持 Algolia DocSearch 集成。如果您使用 classic preset，则无需额外安装。

<details>
<summary>不使用 <code>@docusaurus/preset-classic</code> 时的安装步骤</summary>

1. 安装包：

```bash npm2yarn
npm install --save @docusaurus/theme-search-algolia
```

2. 在 `docusaurus.config.js` 中注册主题：

```js title="docusaurus.config.js"
export default {
  title: '我的网站',
  // ...
  themes: ['@docusaurus/theme-search-algolia'],
  themeConfig: {
    // ...
  },
};
```

</details>

然后，在您的 `themeConfig` 中添加一个 `algolia` 字段。**[申请 DocSearch](https://docsearch.algolia.com/apply/)** 以获取您的 Algolia 索引和 API 密钥。

```js title="docusaurus.config.js"
export default {
  // ...
  themeConfig: {
    // ...
    // highlight-start
    algolia: {
      // Algolia 提供的应用 ID
      appId: 'YOUR_APP_ID',

      // 公共 API 密钥：可以安全地提交它
      apiKey: 'YOUR_SEARCH_API_KEY',

      indexName: 'YOUR_INDEX_NAME',

      // 可选：请参阅下面的文档部分
      contextualSearch: true,

      // 可选：指定导航应通过 window.location 而不是 history.push 发生的域。当我们的 Algolia 配置抓取多个文档站点并且我们希望使用 window.location.href 导航到它们时很有用。
      externalUrlRegex: 'external\\.com|domain\\.com',

      // 可选：替换来自 Algolia 的项目 URL 的部分内容。当使用不同的 baseUrl 为多个部署使用相同的搜索索引时很有用。您可以在 `from` 参数中使用正则表达式或字符串。例如：localhost:3000 vs myCompany.com/docs
      replaceSearchResultPathname: {
        from: '/docs/', // 或作为正则表达式：/\/docs\//
        to: '/',
      },

      // 可选：Algolia 搜索参数
      searchParameters: {},

      // 可选：默认启用的搜索页面的路径（`false` 可禁用）
      searchPagePath: 'search',

      // 可选：是否在 Docsearch 上启用 insights 功能（默认为 `false`）
      insights: false,

      //... 其他 Algolia 参数
    },
    // highlight-end
  },
};
```

:::info

在 Docusaurus v1 中，`searchParameters` 选项曾被命名为 `algoliaOptions`。

有关可能的值，请参阅其[官方 DocSearch 文档](https://docsearch.algolia.com/docs/api#searchparameters)。

:::

:::warning

在 Algolia 抓取您的网站之前，搜索功能将无法可靠工作。

如果在任何重大更改后搜索不起作用，请使用 Algolia 仪表板**触发新的抓取**。

:::

### 上下文搜索 {#contextual-search}

上下文搜索**默认启用**。

它确保搜索结果**与当前语言和版本相关**。

```js title="docusaurus.config.js"
export default {
  // ...
  themeConfig: {
    // ...
    // highlight-start
    algolia: {
      contextualSearch: true,
    },
    // highlight-end
  },
};
```

假设您有 2 个文档版本（**v1** 和 **v2**）和 2 种语言（`en` 和 `fr`）。

在浏览 v2 文档时，返回 v1 文档的搜索结果会很奇怪。有时 v1 和 v2 文档非常相似，您最终会得到相同查询的重复搜索结果（每个版本一个结果）。

同样，在浏览法语网站时，返回英语文档的搜索结果会很奇怪。

为解决此问题，上下文搜索功能会理解您正在浏览特定的文档版本和语言，并将动态创建搜索查询过滤器。

- 在 `/en/docs/v1/myDoc` 上，搜索结果将只包括**v1** 文档的**英语**结果（+ 其他未版本化的页面）
- 在 `/fr/docs/v2/myDoc` 上，搜索结果将只包括**v2** 文档的**法语**结果（+ 其他未版本化的页面）

:::info

当使用 `contextualSearch: true`（默认）时，上下文分面过滤器将与 `algolia.searchParameters.facetFilters` 提供的过滤器合并。

对于特定需求，您可以禁用 `contextualSearch` 并定义自己的 `facetFilters`：

```js title="docusaurus.config.js"
export default {
  // ...
  themeConfig: {
    // ...
    // highlight-start
    algolia: {
      contextualSearch: false,
      searchParameters: {
        facetFilters: ['language:en', ['filter1', 'filter2'], 'filter3'],
      },
    },
    // highlight-end
  },
};
```

请参阅相关的 [Algolia 分面文档](https://www.algolia.com/doc/guides/managing-results/refine-results/faceting/)。

:::

:::warning 上下文搜索不起作用？

如果您只有在禁用上下文搜索时才能获得搜索结果，这很可能是由于[索引配置问题](#algolia-no-search-results)。

:::

### 设计您的 Algolia 搜索样式 {#styling-your-algolia-search}

默认情况下，DocSearch 带有一个经过精心调整的主题，旨在提高可访问性，确保颜色和对比度符合标准。

不过，您仍然可以通过编辑 `/src/css/custom.css` 文件来重用 Docusaurus 的 [Infima CSS 变量](styling-layout.mdx#styling-your-site-with-infima)来设计 DocSearch 的样式。

```css title="/src/css/custom.css"
[data-theme='light'] .DocSearch {
  /* --docsearch-primary-color: var(--ifm-color-primary); */
  /* --docsearch-text-color: var(--ifm-font-color-base); */
  --docsearch-muted-color: var(--ifm-color-secondary-darkest);
  --docsearch-container-background: rgba(94, 100, 112, 0.7);
  /* 模态框 */
  --docsearch-modal-background: var(--ifm-color-secondary-lighter);
  /* 搜索框 */
  --docsearch-searchbox-background: var(--ifm-color-secondary);
  --docsearch-searchbox-focus-background: var(--ifm-color-white);
  /* 命中结果 */
  --docsearch-hit-color: var(--ifm-font-color-base);
  --docsearch-hit-active-color: var(--ifm-color-white);
  --docsearch-hit-background: var(--ifm-color-white);
  /* 页脚 */
  --docsearch-footer-background: var(--ifm-color-white);
}

[data-theme='dark'] .DocSearch {
  --docsearch-text-color: var(--ifm-font-color-base);
  --docsearch-muted-color: var(--ifm-color-secondary-darkest);
  --docsearch-container-background: rgba(47, 55, 69, 0.7);
  /* 模态框 */
  --docsearch-modal-background: var(--ifm-background-color);
  /* 搜索框 */
  --docsearch-searchbox-background: var(--ifm-background-color);
  --docsearch-searchbox-focus-background: var(--ifm-color-black);
  /* 命中结果 */
  --docsearch-hit-color: var(--ifm-font-color-base);
  --docsearch-hit-active-color: var(--ifm-color-white);
  --docsearch-hit-background: var(--ifm-color-emphasis-100);
  /* 页脚 */
  --docsearch-footer-background: var(--ifm-background-surface-color);
  --docsearch-key-gradient: linear-gradient(
    -26.5deg,
    var(--ifm-color-emphasis-200) 0%,
    var(--ifm-color-emphasis-100) 100%
  );
}
```

### 自定义 Algolia 搜索行为 {#customizing-the-algolia-search-behavior}

Algolia DocSearch 支持一个[选项列表](https://docsearch.algolia.com/docs/api/)，您可以将其传递给 `docusaurus.config.js` 文件中的 `algolia` 字段。

```js title="docusaurus.config.js"
export default {
  themeConfig: {
    // ...
    algolia: {
      apiKey: 'YOUR_API_KEY',
      indexName: 'YOUR_INDEX_NAME',
      // 选项...
    },
  },
};
```

### 编辑 Algolia 搜索组件 {#editing-the-algolia-search-component}

如果您更喜欢编辑 Algolia 搜索的 React 组件，可以 [swizzle](swizzling.mdx) `@docusaurus/theme-search-algolia` 中的 `SearchBar` 组件：

```bash npm2yarn
npm run swizzle @docusaurus/theme-search-algolia SearchBar
```

### 故障排除 {#algolia-troubleshooting}

以下是 Docusaurus 用户在使用 Algolia DocSearch 时最常遇到的问题。

#### 没有搜索结果 {#algolia-no-search-results}

看不到搜索结果通常与**索引配置问题**有关。

<details>
  <summary>如何检查我是否有配置问题？</summary>

Docusaurus 使用 [Algolia 分面](https://www.algolia.com/doc/guides/managing-results/refine-results/faceting/)来实现其[上下文搜索](#contextual-search)功能，以创建动态查询，例如：

```json
[
  "language:en",
  [
    "docusaurus_tag:default",
    "docusaurus_tag:docs-default-3.2.1",
    "docusaurus_tag:docs-community-current",
    "docusaurus_tag:docs-docs-tests-current"
  ]
]
```

在 Algolia UI 上，您的索引应允许在 `docusaurus_tag`、`language`、`lang`、`version`、`type` 字段上创建分面查询，如下面的截图所示：

![Algolia 索引显示适当的分面字段](/img/docsearch-troubleshoot-index-facets.jpg)

或者，如果您使用 `{contextualSearch: false}` 禁用[上下文搜索](#contextual-search)（我们不特别推荐这样做），Docusaurus 将不使用分面查询，您应该能看到结果。

</details>

:::danger 使用推荐的配置

我们[推荐特定的 crawler 配置](#algolia-index-configuration)是有原因的。如果您选择使用不同的配置，我们无法提供支持。

:::

您可以按照以下步骤解决索引配置问题：

1. 使用[推荐的 crawler 配置](#algolia-index-configuration)
2. 通过 UI 删除您的索引
3. 通过 UI 触发新的抓取
4. 检查您的索引是否已使用适当的分面字段重新创建：`docusaurus_tag`、`language`、`lang`、`version`、`type`
5. 查看现在是否能获得搜索结果，即使启用了[上下文搜索](#contextual-search)

### 支持 {#algolia-support}

Algolia DocSearch 团队可以帮助您解决网站上的搜索问题。

您可以通过[他们的支持页面](https://algolia.com/support)或在 [Discord](https://discord.gg/wr2m5j948P) 上联系 Algolia。

Docusaurus 在 [Discord](https://discordapp.com/invite/docusaurus) 上也有一个 `#algolia` 频道。

## 👥 使用 Typesense DocSearch {#using-typesense-docsearch}

[Typesense](https://typesense.org) DocSearch 的工作方式与 Algolia DocSearch 类似，只是您的网站被索引到一个 Typesense 搜索集群中。

Typesense 是一个[开源](https://github.com/typesense/typesense)的即时搜索引擎，您可以：

- 在您自己的服务器上[自托管](https://typesense.org/docs/guide/install-typesense.html#option-2-local-machine-self-hosting)
- 或使用托管的 [Typesense Cloud](https://cloud.typesense.org) 服务。

与 Algolia DocSearch 类似，它有两个组件：

- [typesense-docsearch-scraper](https://github.com/typesense/typesense-docsearch-scraper) - 抓取您的网站并将数据索引到您的 Typesense 集群中。
- [docusaurus-theme-search-typesense](https://github.com/typesense/docusaurus-theme-search-typesense) - 一个添加到您网站的搜索栏 UI 组件。

在这里阅读如何[运行 typesense-docsearch-scraper 的分步指南](https://typesense.org/docs/guide/docsearch.html#step-1-set-up-docsearch-scraper)，以及如何[在您的 Docusaurus 网站中安装搜索栏](https://typesense.org/docs/guide/docsearch.html#option-a-docusaurus-powered-sites)。

## 👥 使用本地搜索 {#using-local-search}

对于搜索索引较小且可以在用户访问您的网站时下载到其浏览器的网站，您可以使用本地搜索插件。

您可以在[此处列出的社区支持的本地搜索插件](https://docusaurus.io/community/resources#search)中找到列表。

## 👥 使用您自己的搜索 {#using-your-own-search}

要使用您自己的搜索，可以 swizzle `@docusaurus/theme-classic` 中的 `SearchBar` 组件

```bash npm2yarn
npm run swizzle @docusaurus/theme-classic SearchBar
```

这将在您的项目文件夹中创建一个 `src/theme/SearchBar` 文件。重启您的开发服务器并编辑该组件，您会发现 Docusaurus 现在使用了您自己的 `SearchBar` 组件。

**注意**：您也可以从 [Algolia SearchBar](#editing-the-algolia-search-component) swizzle 并从那里创建您自己的搜索组件。
