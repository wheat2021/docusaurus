---
id: tutorial
description: 本教程将引导您了解 Docusaurus i18n 系统的基础知识。
slug: /i18n/tutorial
---

# i18n - 教程

```mdx-code-block
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
```

本教程将引导您了解 **Docusaurus i18n 系统**的基础知识。

我们将为一个**新初始化的英文 Docusaurus 网站**添加**法文**翻译。

使用 `npx create-docusaurus@latest website classic` 初始化一个新站点（如此[示例](https://github.com/facebook/docusaurus/tree/main/examples/classic)）。

## 配置您的站点 {#configure-your-site}

修改 `docusaurus.config.js` 以添加对法语的 i18n 支持。

### 站点配置 {#site-configuration}

使用[站点 i18n 配置](./../api/docusaurus.config.js.mdx#i18n)来声明 i18n 区域设置：

```js title="docusaurus.config.js"
export default {
  i18n: {
    defaultLocale: 'en',
    locales: ['en', 'fr', 'fa'],
    localeConfigs: {
      en: {
        htmlLang: 'en-GB',
      },
      // 如果您不需要覆盖默认值，可以省略某个区域设置（例如 fr）
      fa: {
        direction: 'rtl',
      },
    },
  },
};
```

区域设置名称用于翻译文件的位置，以及您翻译后区域设置的基础 URL。在构建所有区域设置时，只有默认区域设置的名称会在基础 URL 中被省略。

Docusaurus 使用区域设置名称来提供**合理的默认值**：`<html lang="...">` 属性、区域设置标签、日历格式等。您可以使用 `localeConfigs` 自定义这些默认值。

### 主题配置 {#theme-configuration}

添加一个类型为 `localeDropdown` 的**导航栏项目**，以便用户可以选择他们想要的区域设置：

```js title="docusaurus.config.js"
export default {
  themeConfig: {
    navbar: {
      items: [
        // highlight-start
        {
          type: 'localeDropdown',
          position: 'left',
        },
        // highlight-end
      ],
    },
  },
};
```

:::tip

您可以传递一个查询参数，当用户使用下拉菜单更改区域设置时，该参数将被附加到 URL（例如 `queryString: '?persistLocale=true'`）。

这对于在您的服务器上实现自动区域设置检测很有用。例如，您可以使用此参数将用户的首选区域设置存储在 cookie 中。

:::

### 启动您的站点 {#start-your-site}

以开发模式启动您的本地化站点，使用您选择的区域设置：

```bash npm2yarn
npm run start -- --locale fr
```

您的站点可在 [`http://localhost:3000/fr/`](http://localhost:3000/fr/) 访问。

我们还没有提供任何翻译，所以站点大部分是未翻译的。

:::tip

Docusaurus 为通用的主题标签提供**默认翻译**，例如分页的“下一页”和“上一页”。

请帮助我们完成这些**[默认翻译](https://github.com/facebook/docusaurus/tree/main/packages/docusaurus-theme-translations/locales)**。

:::

:::warning

每个区域设置都是一个**独立的单页应用程序**：不可能同时启动所有区域设置的 Docusaurus 站点。

:::

## 翻译您的站点 {#translate-your-site}

法语区域设置的所有翻译数据都存储在 `website/i18n/fr` 中。每个插件都在相应的文件夹下获取其翻译内容，而 `code.json` 文件定义了 React 代码中使用的所有文本标签。

:::note

复制文件后，使用 `npm run start -- --locale fr` 重新启动您的站点。在编辑现有文件时，热重载会更好地工作。

:::

### 翻译您的 React 代码 {#translate-your-react-code}

对于您自己编写的任何 React 代码：React 页面、React 组件等，您将使用[**翻译 API**](../docusaurus-core.mdx#translate)。

在您的 React 代码中找到所有对用户可见的文本标签，并使用翻译 API 标记它们。有两种 API：

- `<Translate>` 组件将字符串包装为 JSX 元素；
- `translate()` 回调函数接受一个消息并返回一个字符串。

根据上下文语义选择更适合的 API。例如，`<Translate>` 可以用作 React 子元素，而对于期望字符串的 props，可以使用回调函数。

:::warning

JSX 元素是一个_对象_，而不是一个字符串。在期望字符串的上下文中使用它（例如 [`<option>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/option) 的子元素）会[将其强制转换为字符串](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/toString)，返回 `"[object Object]"`。虽然我们鼓励您将 `<Translate>` 用作 JSX 子元素，但仅在它实际有效时才使用元素形式。

:::

```mdx-code-block
<Tabs>
<TabItem value="Before">
```

```jsx title="src/pages/index.js"
import React from 'react';
import Layout from '@theme/Layout';
import Link from '@docusaurus/Link';

export default function Home() {
  return (
    <Layout>
      {/* highlight-next-line */}
      <h1>Welcome to my website</h1>
      <main>
        {/* highlight-start */}
        You can also visit my
        <Link to="https://docusaurus.io/blog">blog</Link>
        {/* highlight-end */}
        <img
          src="/img/home.png"
          // highlight-next-line
          alt="Home icon"
        />
      </main>
    </Layout>
  );
}
```

```mdx-code-block
</TabItem>
<TabItem value="After">
```

```jsx title="src/pages/index.js"
import React from 'react';
import Layout from '@theme/Layout';
import Link from '@docusaurus/Link';

// highlight-next-line
import Translate, {translate} from '@docusaurus/Translate';

export default function Home() {
  return (
    <Layout>
      <h1>
        {/* highlight-next-line */}
        <Translate>Welcome to my website</Translate>
      </h1>
      <main>
        {/* highlight-start */}
        <Translate
          id="homepage.visitMyBlog"
          description="The homepage message to ask the user to visit my blog"
          values={{
            blogLink: (
              <Link to="https://docusaurus.io/blog">
                <Translate
                  id="homepage.visitMyBlog.linkLabel"
                  description="The label for the link to my blog">
                  blog
                </Translate>
              </Link>
            ),
          }}>
          {'You can also visit my {blogLink}'}
        </Translate>
        {/* highlight-end */}

        <img
          src="/img/home.png"
          alt={
            // highlight-start
            translate({
              message: 'Home icon',
              description: 'The homepage icon alt message',
            })
            // highlight-end
          }
        />
      </main>
    </Layout>
  );
}
```

```mdx-code-block
</TabItem>
</Tabs>
```

:::info

Docusaurus 有意提供一个**非常小巧轻量的翻译运行时**，并且只支持基本的[占位符插值](../docusaurus-core.mdx#interpolate)，使用 [ICU 消息格式](https://formatjs.io/docs/core-concepts/icu-syntax/)的子集。

大多数文档网站通常是**静态**的，不需要高级的 i18n 功能（**复数**、**性别**等）。对于更高级的用例，请使用像 [react-intl](https://www.npmjs.com/package/react-intl) 这样的库。

:::

`docusaurus write-translations` 命令将静态分析您站点中使用的所有 React 代码文件，提取对这些 API 的调用，并将它们聚合到 `code.json` 文件中。翻译文件将作为从 ID 到翻译消息对象（包括翻译后的标签和标签的描述）的映射进行存储。在您对翻译 API 的调用中（`<Translate>` 或 `translate()`），您需要指定默认的未翻译消息或 ID，以便 Docusaurus 正确地将每个翻译条目与 API 调用关联起来。

:::warning 文本标签必须是静态的

`docusaurus write-translations` 命令只对您的代码进行**静态分析**。它实际上并不运行您的站点。因此，动态消息无法被提取，因为消息是一个_表达式_，而不是一个_字符串_：

```jsx
const items = [
  {id: 1, title: 'Hello'},
  {id: 2, title: 'World'},
];

function ItemsList() {
  return (
    <ul>
      {/* 不要这样做：这不适用于 write-translations 命令 */}
      {items.map((item) => (
        <li key={item.id}>
          <Translate>{item.title}</Translate>
        </li>
      ))}
    </ul>
  );
}
```

这在运行时仍然可以正常工作。然而，未来我们可能会提供一个“无运行时”机制，允许通过 Babel 转换将翻译直接内联到 React 代码中，而不是在运行时调用 API。因此，为了面向未来，您应该始终偏好静态可分析的消息。例如，我们可以将上面的代码重构为：

```jsx
const items = [
  {id: 1, title: <Translate>Hello</Translate>},
  {id: 2, title: <Translate>World</Translate>},
];

function ItemsList() {
  return (
    <ul>
      {/* 渲染时标题已经翻译好了！ */}
      {items.map((item) => (
        <li key={item.id}>{item.title}</li>
      ))}
    </ul>
  );
}
```

您可以将对翻译 API 的调用纯粹视为_标记_，告诉 Docusaurus “这里有一个文本标签需要被替换为翻译后的消息”。

:::

#### 复数形式 {#pluralization}

当您运行 `write-translations` 时，您会注意到一些标签是复数形式的：

```json title="i18n/en/code.json"
{
  // ...
  "theme.blog.post.plurals": "One post|{count} posts"
  // ...
}
```

每种语言都会有一个[可能的复数类别](https://unicode-org.github.io/cldr-staging/charts/37/supplemental/language_plural_rules.html)列表。Docusaurus 会按照 `["zero", "one", "two", "few", "many", "other"]` 的顺序排列它们。例如，因为英语（`en`）有两种复数形式（“one”和“other”），所以翻译消息有两个用管道符（`|`）分隔的标签。对于有三种复数形式（“one”、“few”和“many”）的波兰语（`pl`），您需要按该顺序提供三个用管道符连接的标签。

您也可以对自己的代码消息进行复数化：

```jsx
import {translate} from '@docusaurus/Translate';
import {usePluralForm} from '@docusaurus/theme-common';

function ItemsList({items}) {
  // `usePluralForm` 将为当前区域设置提供复数选择器
  const {selectMessage} = usePluralForm();
  // 根据 `items.length` 选择适当的复数标签
  const message = selectMessage(
    items.length,
    translate(
      {message: 'One item|{count} items'},
      {count: items.length},
    ),
  );
  return (
    <>
      <h2>{message}</h2>
      <ul>{items.map((item) => <li key={item.id}>{item.title}</li>)}</ul>
    </>
  );
}
```

:::note

Docusaurus 使用 [`Intl.PluralRules`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/PluralRules) 来解析和选择复数形式。为了让 `selectMessage` 正常工作，提供正确数量和顺序的复数形式非常重要。

:::

### 翻译插件数据 {#translate-plugin-data}

JSON 翻译文件用于所有散布在您代码中的内容：

- React 代码，包括您上面标记的翻译标签
- 主题配置中的导航栏和页脚标签
- `sidebars.js` 中的文档侧边栏分类标签
- 插件选项中的博客侧边栏标题
- ...

运行 [write-translations](../cli.mdx#docusaurus-write-translations-sitedir) 命令：

```bash npm2yarn
npm run write-translations -- --locale fr
```

它将提取并初始化您需要翻译的 JSON 翻译文件。根目录下的 `code.json` 文件包含了从源代码中提取的所有翻译 API 调用，这些调用可能是您自己编写的，也可能是主题提供的，其中一些可能已经默认翻译好了。

```json title="i18n/fr/code.json"
{
  // <Translate> 组件没有 ID：默认消息被用作 ID
  "Welcome to my website": {
    "message": "Welcome to my website"
  },
  "home.visitMyBlog": {
    "message": "You can also visit my {blog}",
    "description": "The homepage message to ask the user to visit my blog"
  },
  "homepage.visitMyBlog.linkLabel": {
    "message": "Blog",
    "description": "The label for the link to my blog"
  },
  "Home icon": {
    "message": "Home icon",
    "description": "The homepage icon alt message"
  }
}
```

插件和主题也会写入它们自己的 JSON 翻译文件，例如：

```json title="i18n/fr/docusaurus-theme-classic/navbar.json"
{
  "title": {
    "message": "My Site",
    "description": "The title in the navbar"
  },
  "item.label.Docs": {
    "message": "Docs",
    "description": "Navbar item with label Docs"
  },
  "item.label.Blog": {
    "message": "Blog",
    "description": "Navbar item with label Blog"
  },
  "item.label.GitHub": {
    "message": "GitHub",
    "description": "Navbar item with label GitHub"
  }
}
```

翻译 `i18n/fr` 中 JSON 文件的 `message` 属性，您的站点布局和主页现在应该被翻译了。

### 翻译 Markdown 文件 {#translate-markdown-files}

官方的 Docusaurus 内容插件广泛使用 Markdown/MDX 文件，并允许您翻译它们。

#### 翻译文档 {#translate-the-docs}

将您的文档 Markdown 文件从 `docs/` 复制到 `i18n/fr/docusaurus-plugin-content-docs/current`，然后翻译它们：

```bash
mkdir -p i18n/fr/docusaurus-plugin-content-docs/current
cp -r docs/** i18n/fr/docusaurus-plugin-content-docs/current
```

:::info

请注意，`docusaurus-plugin-content-docs` 插件总是按版本划分其内容。`./docs` 文件夹中的数据将在 `current` 子文件夹和 `current.json` 文件中进行翻译。有关“current”的含义，请参阅[文档版本控制指南](../guides/docs/versioning.mdx#terminology)。

:::

#### 翻译博客 {#translate-the-blog}

将您的博客 Markdown 文件复制到 `i18n/fr/docusaurus-plugin-content-blog`，然后翻译它们：

```bash
mkdir -p i18n/fr/docusaurus-plugin-content-blog
cp -r blog/** i18n/fr/docusaurus-plugin-content-blog
```

#### 翻译页面 {#translate-the-pages}

将您的页面 Markdown 文件复制到 `i18n/fr/docusaurus-plugin-content-pages`，然后翻译它们：

```bash
mkdir -p i18n/fr/docusaurus-plugin-content-pages
cp -r src/pages/**.md i18n/fr/docusaurus-plugin-content-pages
cp -r src/pages/**.mdx i18n/fr/docusaurus-plugin-content-pages
```

:::warning

我们只复制 `.md` 和 `.mdx` 文件，因为 React 页面已经通过 JSON 翻译文件进行翻译了。

:::

:::tip 使用明确的标题 ID

默认情况下，Markdown 标题 `### Hello World` 会生成一个 ID `hello-world`。其他文档可以使用 `[link](#hello-world)` 链接到它。然而，翻译后，标题变为 `### Bonjour le Monde`，ID 为 `bonjour-le-monde`。

生成的 ID 并不总是适合本地化站点，因为它需要您本地化所有的锚点链接：

```diff
- [link](#hello-world).
+ [link](#bonjour-le-monde)
```

对于本地化站点，建议使用**[明确的标题 ID](../guides/markdown-features/markdown-features-toc.mdx#heading-ids)**。

:::

## 部署您的站点 {#deploy-your-site}

您可以选择在**单个域名**下部署您的站点，或使用**多个（子）域名**。

:::tip 关于本地化的 baseUrls

除了默认区域设置外，Docusaurus 会自动为其他区域设置的站点添加一个 `/<locale>/` 路径段。这种启发式方法对大多数站点都适用，但可以根据您的部署要求为每个区域设置单独配置。

更多信息请阅读 [`siteConfig.baseUrl`](../api/docusaurus.config.js.mdx#baseUrl) 文档。

:::

### 单域名部署 {#single-domain-deployment}

运行以下命令：

```bash npm2yarn
npm run build
```

Docusaurus 将为**每个区域设置构建一个单页应用程序**：

- `website/build`：用于默认的英语语言
- `website/build/fr`：用于法语语言

您现在可以将 `build` 文件夹[部署](../deployment.mdx)到您选择的静态托管解决方案。

:::note

Docusaurus 网站使用此策略：

- [`https://docusaurus.io`](https://docusaurus.io)
- [`https://docusaurus.io/fr`](https://docusaurus.io/fr)

:::

:::tip

静态托管提供商通常会将 `/unknown/url` 重定向到 `/404.html`，总是显示一个**英文 404 页面**。

通过配置您的主机将 `/fr/*` 重定向到 `/fr/404.html` 来**本地化您的 404 页面**。

这并非总是可行，取决于您的主机：GitHub Pages 无法做到这一点，[Netlify](https://docs.netlify.com/routing/redirects/redirect-options/#custom-404-page-handling) 可以。

:::

### 多域名部署 {#multi-domain-deployment}

您也可以为单个区域设置构建您的站点：

```bash npm2yarn
npm run build -- --locale fr
```

当一次只构建一个区域设置时，Docusaurus 不会自动添加 `/fr/` URL 前缀，假设您希望将每个区域设置部署到不同的域名。

在您的[静态托管提供商](../deployment.mdx)上：

- 为每个区域设置创建一个部署
- 使用 `--locale` 选项配置适当的构建命令
- 为每个部署配置您选择的（子）域名

:::tip 为每个区域设置配置 URL

使用 [`siteConfig.i18n.localeConfigs[<locale>].url`](./../api/docusaurus.config.js.mdx#i18n) 属性为每个区域设置配置一个不同的站点 URL：

```ts title=docusaurus.config.js
const config = {
  i18n: {
    localeConfigs: {
      // highlight-start
      en: {
        url: 'https://en.docusaurus.io',
        baseUrl: '/',
      },
      fr: {
        url: 'https://fr.docusaurus.io',
        baseUrl: '/',
      },
      // highlight-end
    },
  },
};
```

这有助于[搜索引擎（如 Google）了解您页面的本地化版本](https://developers.google.com/search/docs/specialty/international/localized-versions)，这要归功于 `<link rel="alternate" hreflang="<locale>"/>` 元标签。

这也允许 Docusaurus 主题在用户切换区域设置时将用户重定向到适当的 URL，通常通过[导航栏区域设置下拉菜单](../api/themes/theme-configuration.mdx#navbar-locale-dropdown)。

更多信息请阅读 [`siteConfig.url`](../api/docusaurus.config.js.mdx#baseUrl) 和 [`siteConfig.baseUrl`](../api/docusaurus.config.js.mdx#baseUrl) 文档。

:::

:::warning

此策略**不适用于** GitHub Pages，因为它只可能**有单个部署**。

:::

### 混合部署 {#hybrid}

可以使某些区域设置使用子路径，而其他区域设置使用子域名。

也可以将每个区域设置部署为单独的子域名，然后在 CDN 级别将子域名组合成一个统一的域名：

- 将您的站点部署为 `fr.docusaurus.io`
- 配置 CDN 从 `docusaurus.io/fr` 提供服务

## 管理翻译 {#managing-translations}

Docusaurus 不关心您如何管理翻译：它所需要的只是在构建期间，所有翻译文件（JSON、Markdown 或其他数据文件）在文件系统中可用。然而，作为站点创建者，您需要考虑如何管理翻译，以便您的翻译贡献者可以很好地协作。

我们将分享两种常见的翻译协作策略：[**使用 git**](./i18n-git.mdx) 和 [**使用 Crowdin**](./i18n-crowdin.mdx)。
```
