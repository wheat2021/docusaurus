---
sidebar_position: 8
slug: /api/plugins/@docusaurus/plugin-ideal-image
---

# 📦 plugin-ideal-image

import APITable from '@site/src/components/APITable';

Docusaurus 插件，用于生成近乎理想的图片（响应式、懒加载、低质量占位符）。

:::info

默认情况下，该插件在**开发环境中处于非活动状态**，因此你始终可以查看全尺寸图片。如果你想调试理想图片的行为，可以将 [`disableInDev`](#disableInDev) 选项设置为 `false`。

:::

## 安装 {#installation}

```bash npm2yarn
npm install --save @docusaurus/plugin-ideal-image
```

## 用法 {#usage}

此插件仅支持 PNG 和 JPG 格式。

```jsx
import Image from '@theme/IdealImage';
import thumbnail from './path/to/img.png';

// 你的 React 代码
<Image img={thumbnail} />

// 或
<Image img={require('./path/to/img.png')} />
```

:::warning

此插件注册了一个 [Webpack loader](https://webpack.js.org/loaders/)，它会改变导入/require 的图片类型：

- 之前：`string`
- 之后：`{preSrc: string, src: import("@theme/IdealImage").SrcImage}`

:::

:::warning 致 pnpm 用户

从 [pnpm 10](https://github.com/pnpm/pnpm/releases/tag/v10.0.0) 开始，运行 `pnpm install` 默认不会运行依赖项的安装脚本。你需要为我们的 `sharp` 图片调整依赖项进行额外的 pnpm 配置（[issue](https://github.com/lovell/sharp/issues/4343)），以便其正确安装，例如：

```json title="package.json"
{
  "pnpm": {
    "onlyBuiltDependencies": ["fsevents"]
  }
}
```

:::

## 配置 {#configuration}

接受的字段：

```mdx-code-block
<APITable>
```

| 选项 | 类型 | 默认值 | 描述 |
| --- | --- | --- | --- |
| `name` | `string` | `ideal-img/[name].[hash:hex:7].[width].[ext]` | 输出文件的文件名模板。 |
| `sizes` | `number[]` | _原始尺寸_ | 指定你想要使用的所有宽度。如果指定尺寸超过原始图片宽度，将使用后者（即图片不会被放大）。 |
| `size` | `number` | _原始尺寸_ | 指定你想要使用的一个宽度；如果指定尺寸超过原始图片宽度，将使用后者（即图片不会被放大） |
| `min` | `number` | | 作为手动指定 `sizes` 的替代方案，你可以指定 `min`、`max` 和 `steps`，尺寸将为你自动生成。 |
| `max` | `number` | | 见上面的 `min` |
| `steps` | `number` | `4` | 配置在 `min` 和 `max` 之间（含）生成的图片数量 |
| `quality` | `number` | `85` | JPEG 压缩质量 |
| `disableInDev` | `boolean` | `true` | 你可以通过将此项设置为 `false` 来在开发模式下测试理想图片的行为。**提示**：在浏览器中使用[网络节流](https://www.browserstack.com/guide/how-to-perform-network-throttling-in-chrome)来模拟慢速网络。 |

```mdx-code-block
</APITable>
```

### 配置示例 {#ex-config}

这是一个配置示例：

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-ideal-image',
      // highlight-start
      {
        quality: 70,
        max: 1030, // 调整后图片的最大尺寸。
        min: 640, // 调整后图片的最小尺寸。如果原始尺寸更小，则使用原始尺寸。
        steps: 2, // 在 min 和 max（含）之间生成的最大图片数量
        disableInDev: false,
      },
      // highlight-end
    ],
  ],
};
```
