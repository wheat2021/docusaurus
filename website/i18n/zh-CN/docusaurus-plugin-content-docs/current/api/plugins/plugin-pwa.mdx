---
sidebar_position: 9
slug: /api/plugins/@docusaurus/plugin-pwa
---

# ğŸ“¦ plugin-pwa

Docusaurus æ’ä»¶ï¼Œç”¨äºé€šè¿‡ [Workbox](https://developers.google.com/web/tools/workbox) æ·»åŠ  PWA æ”¯æŒã€‚è¯¥æ’ä»¶ä»…åœ¨ç”Ÿäº§æ„å»ºä¸­ç”Ÿæˆä¸€ä¸ª [Service Worker](https://developers.google.com/web/fundamentals/primers/service-workers)ï¼Œå¹¶å…è®¸ä½ åˆ›å»ºå®Œå…¨ç¬¦åˆ PWA æ ‡å‡†ã€æ”¯æŒç¦»çº¿å’Œå®‰è£…çš„æ–‡æ¡£ç½‘ç«™ã€‚

## å®‰è£… {#installation}

```bash npm2yarn
npm install --save @docusaurus/plugin-pwa
```

## é…ç½® {#configuration}

åœ¨ `./static/manifest.json` åˆ›å»ºä¸€ä¸ª [PWA manifest](https://web.dev/add-manifest/)ã€‚

ä½¿ç”¨ä¸€ä¸ªæœ€å°åŒ–çš„ PWA é…ç½®ä¿®æ”¹ `docusaurus.config.js`ï¼Œä¾‹å¦‚ï¼š

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        debug: true,
        offlineModeActivationStrategies: [
          'appInstalled',
          'standalone',
          'queryString',
        ],
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json', // ä½ çš„ PWA manifest
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
        ],
      },
    ],
  ],
};
```

## æ¸è¿›å¼ Web åº”ç”¨ {#progressive-web-app}

ä»…ä»…å®‰è£…ä¸€ä¸ª service worker ä¸è¶³ä»¥è®©ä½ çš„åº”ç”¨æˆä¸ºä¸€ä¸ª PWAã€‚ä½ è‡³å°‘éœ€è¦åŒ…å«ä¸€ä¸ª [Web App Manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest) å¹¶åœ¨ `<head>` ä¸­æœ‰æ­£ç¡®çš„æ ‡ç­¾ï¼ˆ[é€‰é¡¹ > pwaHead](#pwahead)ï¼‰ã€‚

éƒ¨ç½²åï¼Œä½ å¯ä»¥ä½¿ç”¨ [Lighthouse](https://developers.google.com/web/tools/lighthouse) å¯¹ä½ çš„ç½‘ç«™è¿›è¡Œå®¡è®¡ã€‚

æœ‰å…³ä½¿ä½ çš„ç½‘ç«™æˆä¸º PWA çš„æ›´è¯¦å°½åˆ—è¡¨ï¼Œè¯·å‚é˜… [PWA æ¸…å•](https://developers.google.com/web/progressive-web-apps/checklist)ã€‚

## åº”ç”¨å®‰è£…æ”¯æŒ {#app-installation-support}

å¦‚æœä½ çš„æµè§ˆå™¨æ”¯æŒï¼Œä½ åº”è¯¥èƒ½å°† Docusaurus ç½‘ç«™ä½œä¸ºåº”ç”¨å®‰è£…ã€‚

![å®‰è£…è¿‡ç¨‹çš„å±å¹•å½•åƒã€‚æµè§ˆå™¨åœ°å€æ ä¸­å‡ºç°ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»åæ˜¾ç¤ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œè¯¢é—®â€œå®‰è£…æ­¤åº”ç”¨ç¨‹åºï¼Ÿâ€ã€‚ç‚¹å‡»â€œå®‰è£…â€æŒ‰é’®åï¼Œæ“ä½œç³»ç»Ÿä¸­ä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºï¼Œå¹¶æ‰“å¼€ Docusaurus ä¸»é¡µã€‚](/img/pwa_install.gif)

:::note

åº”ç”¨å®‰è£…éœ€è¦ HTTPS åè®®å’Œä¸€ä¸ªæœ‰æ•ˆçš„ manifestã€‚

:::

## ç¦»çº¿æ¨¡å¼ï¼ˆé¢„ç¼“å­˜ï¼‰ {#offline-mode-precaching}

æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ service-worker é¢„ç¼“å­˜ï¼Œè®©ç”¨æˆ·å¯ä»¥ç¦»çº¿æµè§ˆ Docusaurus ç½‘ç«™ã€‚

[workbox-precaching](https://developers.google.com/web/tools/workbox/modules/workbox-precaching) é¡µé¢è§£é‡Šäº†è¿™ä¸ªæƒ³æ³•ï¼š

> Service worker çš„ä¸€ä¸ªç‰¹æ€§æ˜¯èƒ½å¤Ÿåœ¨ service worker å®‰è£…æ—¶å°†ä¸€ç»„æ–‡ä»¶ä¿å­˜åˆ°ç¼“å­˜ä¸­ã€‚è¿™é€šå¸¸è¢«ç§°ä¸ºâ€œé¢„ç¼“å­˜â€ï¼Œå› ä¸ºä½ åœ¨ä½¿ç”¨ service worker ä¹‹å‰å°±ç¼“å­˜äº†å†…å®¹ã€‚
>
> è¿™æ ·åšçš„ä¸»è¦åŸå› æ˜¯å®ƒè®©å¼€å‘è€…å¯ä»¥æ§åˆ¶ç¼“å­˜ï¼Œæ„å‘³ç€ä»–ä»¬å¯ä»¥å†³å®šæ–‡ä»¶ä½•æ—¶è¢«ç¼“å­˜ã€ç¼“å­˜å¤šé•¿æ—¶é—´ï¼Œå¹¶å°†å…¶æä¾›ç»™æµè§ˆå™¨è€Œæ— éœ€è®¿é—®ç½‘ç»œï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥ç”¨æ¥åˆ›å»ºç¦»çº¿å·¥ä½œçš„ Web åº”ç”¨ã€‚
>
> Workbox é€šè¿‡ç®€åŒ– API å’Œç¡®ä¿èµ„æºè¢«é«˜æ•ˆä¸‹è½½ï¼Œå¤§å¤§å‡è½»äº†é¢„ç¼“å­˜çš„ç¹é‡å·¥ä½œã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç½‘ç«™ä½œä¸ºåº”ç”¨å®‰è£…æ—¶ï¼Œç¦»çº¿æ¨¡å¼æ˜¯å¯ç”¨çš„ã€‚è¯¦æƒ…è¯·è§ `offlineModeActivationStrategies` é€‰é¡¹ã€‚

åœ¨ç½‘ç«™è¢«é¢„ç¼“å­˜åï¼Œservice worker å°†ä¸ºåç»­è®¿é—®æä¾›ç¼“å­˜çš„å“åº”ã€‚å½“éƒ¨ç½²äº†æ–°çš„æ„å»ºç‰ˆæœ¬å’Œæ–°çš„ service worker æ—¶ï¼Œæ–°çš„ service worker å°†å¼€å§‹å®‰è£…å¹¶æœ€ç»ˆè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚åœ¨è¿™ä¸ªç­‰å¾…çŠ¶æ€æœŸé—´ï¼Œä¼šæ˜¾ç¤ºä¸€ä¸ªé‡è½½å¼¹çª—ï¼Œè¦æ±‚ç”¨æˆ·é‡æ–°åŠ è½½é¡µé¢ä»¥è·å–æ–°å†…å®¹ã€‚åœ¨ç”¨æˆ·æ¸…é™¤åº”ç”¨ç¼“å­˜æˆ–ç‚¹å‡»å¼¹çª—ä¸Šçš„â€œé‡è½½â€æŒ‰é’®ä¹‹å‰ï¼Œservice worker å°†ç»§ç»­æä¾›æ—§å†…å®¹ã€‚

:::warning

ç¦»çº¿æ¨¡å¼/é¢„ç¼“å­˜éœ€è¦é¢„å…ˆä¸‹è½½ç½‘ç«™çš„æ‰€æœ‰é™æ€èµ„æºï¼Œå¯èƒ½ä¼šæ¶ˆè€—ä¸å¿…è¦çš„å¸¦å®½ã€‚å¯¹äºæ‰€æœ‰ç±»å‹çš„ç½‘ç«™æ¥è¯´ï¼Œæ¿€æ´»å®ƒå¯èƒ½ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚

:::

## é€‰é¡¹ {#options}

### `debug` {#debug}

- ç±»å‹ï¼š`boolean`
- é»˜è®¤å€¼ï¼š`false`

å¼€å¯è°ƒè¯•æ¨¡å¼ï¼š

- Workbox æ—¥å¿—
- é¢å¤–çš„ Docusaurus æ—¥å¿—
- æœªä¼˜åŒ–çš„ SW æ–‡ä»¶è¾“å‡º
- Source maps

### `offlineModeActivationStrategies` {#offlinemodeactivationstrategies}

- ç±»å‹ï¼š`('appInstalled' | 'mobile' | 'saveData'| 'queryString' | 'always')[]`
- é»˜è®¤å€¼ï¼š`['appInstalled', 'queryString', 'standalone']`

ç”¨äºå¼€å¯ç¦»çº¿æ¨¡å¼çš„ç­–ç•¥ï¼š

- `appInstalled`ï¼šä¸ºå·²å°†ç½‘ç«™ä½œä¸ºåº”ç”¨å®‰è£…çš„ç”¨æˆ·æ¿€æ´»ï¼ˆå¹¶é 100% å¯é ï¼‰
- `standalone`ï¼šä¸ºä»¥ç‹¬ç«‹æ¨¡å¼è¿è¡Œåº”ç”¨çš„ç”¨æˆ·æ¿€æ´»ï¼ˆPWA å®‰è£…åé€šå¸¸æ˜¯è¿™ç§æƒ…å†µï¼‰
- `queryString`ï¼šå¦‚æœæŸ¥è¯¢å­—ç¬¦ä¸²åŒ…å« `offlineMode=true` åˆ™æ¿€æ´»ï¼ˆä¾¿äº PWA è°ƒè¯•ï¼‰
- `mobile`ï¼šä¸ºç§»åŠ¨ç”¨æˆ·æ¿€æ´» (`width <= 996px`)
- `saveData`ï¼šä¸º `navigator.connection.saveData === true` çš„ç”¨æˆ·æ¿€æ´»
- `always`ï¼šä¸ºæ‰€æœ‰ç”¨æˆ·æ¿€æ´»

:::warning

è¯·è°¨æ…ä½¿ç”¨ï¼šä¸€äº›ç”¨æˆ·å¯èƒ½ä¸å–œæ¬¢è¢«å¼ºåˆ¶ä½¿ç”¨ç¦»çº¿æ¨¡å¼ã€‚

:::

:::danger

æ— æ³•å¯é åœ°æ£€æµ‹ä¸€ä¸ªé¡µé¢æ˜¯å¦è¢«æ¸²æŸ“ä¸º PWAã€‚

`appinstalled` äº‹ä»¶å·²ä»[è§„èŒƒä¸­ç§»é™¤](https://github.com/w3c/manifest/pull/836)ï¼Œè€Œ [`navigator.getInstalledRelatedApps()`](https://web.dev/get-installed-related-apps/) API ä»…åœ¨æœ€æ–°çš„ Chrome ç‰ˆæœ¬ä¸­å—æ”¯æŒï¼Œå¹¶è¦æ±‚åœ¨ manifest ä¸­å£°æ˜ `related_applications`ã€‚

[`standalone` ç­–ç•¥](https://petelepage.com/blog/2019/07/is-my-pwa-installed/)æ˜¯æ¿€æ´»ç¦»çº¿æ¨¡å¼çš„ä¸€ä¸ªä¸é”™çš„åå¤‡æ–¹æ¡ˆï¼ˆè‡³å°‘åœ¨è¿è¡Œå·²å®‰è£…çš„åº”ç”¨æ—¶ï¼‰ã€‚

:::

### `injectManifestConfig` {#injectmanifestconfig}

ä¼ é€’ç»™ `workbox.injectManifest()` çš„ [Workbox é€‰é¡¹](https://developer.chrome.com/docs/workbox/reference/workbox-build/#type-InjectManifestOptions)ã€‚è¿™è®©ä½ èƒ½å¤Ÿæ§åˆ¶å“ªäº›èµ„æºå°†è¢«é¢„ç¼“å­˜ï¼Œå¹¶å¯ç¦»çº¿ä½¿ç”¨ã€‚

- ç±»å‹ï¼š`InjectManifestOptions`
- é»˜è®¤å€¼ï¼š`{}`

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        injectManifestConfig: {
          manifestTransforms: [
            //...
          ],
          modifyURLPrefix: {
            //...
          },
          // æˆ‘ä»¬å·²ç»æ·»åŠ äº†å¸¸è§„çš„é™æ€èµ„æºï¼ˆHTMLã€å›¾ç‰‡ç­‰ï¼‰ä»¥ä¾¿ç¦»çº¿ä½¿ç”¨
          // ä½ å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æ›´å¤šæ–‡ä»¶
          globPatterns: ['**/*.{pdf,docx,xlsx}'],
          // ...
        },
      },
    ],
  ],
};
```

### `pwaHead` {#pwahead}

- ç±»å‹ï¼š`({ tagName: string; [attributeName: string]: string })[]`
- é»˜è®¤å€¼ï¼š`[]`

ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼ŒåŒ…å«è¦æ³¨å…¥åˆ° `<head>` æ ‡ç­¾çš„ `tagName` å’Œå±æ€§çš„é”®å€¼å¯¹ã€‚ç†è®ºä¸Šä½ å¯ä»¥é€šè¿‡å®ƒæ³¨å…¥ä»»ä½• head æ ‡ç­¾ï¼Œä½†ç†æƒ³æƒ…å†µä¸‹å®ƒç”¨äºä½¿ä½ çš„ç½‘ç«™ç¬¦åˆ PWA è§„èŒƒçš„æ ‡ç­¾ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä½¿ä½ çš„åº”ç”¨å®Œå…¨åˆè§„çš„æ ‡ç­¾åˆ—è¡¨ï¼š

```js
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json',
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-capable',
            content: 'yes',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-status-bar-style',
            content: '#000',
          },
          {
            tagName: 'link',
            rel: 'apple-touch-icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'mask-icon',
            href: '/img/docusaurus.svg',
            color: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileImage',
            content: '/img/docusaurus.png',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileColor',
            content: '#000',
          },
        ],
      },
    ],
  ],
};
```

### `swCustom` {#swcustom}

- ç±»å‹ï¼š`string | undefined`
- é»˜è®¤å€¼ï¼š`undefined`

å¯ç”¨äºé¢å¤–çš„ Workbox è§„åˆ™ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œåšä»»ä½• service worker èƒ½åšçš„äº‹æƒ…ï¼Œå¹¶ä½¿ç”¨ workbox åº“çš„å…¨éƒ¨åŠŸèƒ½ã€‚ä»£ç ä¼šè¢«è½¬è¯‘ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ç°ä»£çš„ ES6+ è¯­æ³•ã€‚

ä¾‹å¦‚ï¼Œç¼“å­˜æ¥è‡ªå¤–éƒ¨è·¯ç”±çš„æ–‡ä»¶ï¼š

```js
import {registerRoute} from 'workbox-routing';
import {StaleWhileRevalidate} from 'workbox-strategies';

// é»˜è®¤çš„ fn å¯¼å‡ºï¼Œæ¥æ”¶ä¸€äº›æœ‰ç”¨çš„å‚æ•°
export default function swCustom(params) {
  const {
    debug, // :boolean
    offlineMode, // :boolean
  } = params;

  // ç¼“å­˜æ¥è‡ªå¤–éƒ¨èµ„æºçš„å“åº”
  registerRoute((context) => {
    return [
      /graph\.facebook\.com\/.*\/picture/,
      /netlify\.com\/img/,
      /avatars1\.githubusercontent/,
    ].some((regex) => context.url.href.match(regex));
  }, new StaleWhileRevalidate());
}
```

è¯¥æ¨¡å—åº”æœ‰ä¸€ä¸ª `default` å‡½æ•°å¯¼å‡ºï¼Œå¹¶æ¥æ”¶ä¸€äº›å‚æ•°ã€‚

### `swRegister` {#swregister}

- ç±»å‹ï¼š`string | false`
- é»˜è®¤å€¼ï¼š`'docusaurus-plugin-pwa/src/registerSW.js'`

åœ¨ Docusaurus åº”ç”¨ä¹‹å‰æ·»åŠ ä¸€ä¸ªå…¥å£ï¼Œä»¥ä¾¿åœ¨åº”ç”¨è¿è¡Œå‰è¿›è¡Œæ³¨å†Œã€‚é»˜è®¤çš„ `registerSW.js` æ–‡ä»¶è¶³ä»¥æ»¡è¶³ç®€å•çš„æ³¨å†Œéœ€æ±‚ã€‚

ä¼ é€’ `false` å°†å®Œå…¨ç¦ç”¨æ³¨å†Œã€‚

## Manifest ç¤ºä¾‹ {#manifest-example}

Docusaurus ç½‘ç«™çš„ manifest å¯ä»¥ä½œä¸ºä¸€ä¸ªå‚è€ƒï¼š

```mdx-code-block
import CodeBlock from '@theme/CodeBlock';

<CodeBlock className="language-json">
  {JSON.stringify(require('@site/static/manifest.json'),null,2)}
</CodeBlock>
```

## è‡ªå®šä¹‰é‡è½½å¼¹çª— {#customizing-reload-popup}

å½“æœ‰æ–°çš„ service worker ç­‰å¾…å®‰è£…æ—¶ï¼Œä¼šæ¸²æŸ“ `@theme/PwaReloadPopup` ç»„ä»¶ï¼Œæˆ‘ä»¬å‘ç”¨æˆ·å»ºè®®é‡è½½ã€‚ä½ å¯ä»¥ [swizzle](../../swizzling.mdx) è¿™ä¸ªç»„ä»¶å¹¶å®ç°ä½ è‡ªå·±çš„ UIã€‚å®ƒä¼šæ¥æ”¶ä¸€ä¸ª `onReload` å›è°ƒä½œä¸º propsï¼Œå½“ç‚¹å‡» `reload` æŒ‰é’®æ—¶åº”è°ƒç”¨è¯¥å›è°ƒã€‚è¿™å°†å‘Šè¯‰ service worker å®‰è£…ç­‰å¾…ä¸­çš„ service worker å¹¶é‡æ–°åŠ è½½é¡µé¢ã€‚

é»˜è®¤ä¸»é¢˜åŒ…å«äº†é‡è½½å¼¹çª—çš„å®ç°ï¼Œå¹¶ä½¿ç”¨äº† [Infima Alerts](https://infima.dev/docs/components/alert)ã€‚

![é‡è½½è¿‡ç¨‹çš„å±å¹•å½•åƒã€‚ä¸€ä¸ªè­¦æŠ¥æ¡†æ˜¾ç¤ºåœ¨çª—å£å³ä¸‹è§’ï¼Œæç¤ºâ€œæœ‰æ–°å†…å®¹å¯ç”¨â€ã€‚ç‚¹å‡»â€œåˆ·æ–°â€æŒ‰é’®åï¼Œé¡µé¢çš„ä¸»æ ‡é¢˜ä»â€œä»‹ç»â€å˜ä¸ºâ€œPWA :))â€ã€‚](/img/pwa_reload.gif)

ä½ çš„ç»„ä»¶å¯ä»¥æ¸²æŸ“ `null`ï¼Œä½†ä¸å»ºè®®è¿™æ ·åšï¼šç”¨æˆ·å°†æ— æ³•è·å–æœ€æ–°çš„å†…å®¹ã€‚
